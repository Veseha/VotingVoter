<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <!--    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>-->
    <script src="https://kit.fontawesome.com/769fe7db1b.js" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <title>Petitions</title>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary bg-dark " data-bs-theme="dark">
    <div class="container-fluid">
        <a class="navbar-brand" title="My PPWs" href="/myppwlist">
            Peticja
            <!--                <label style="color: #ffc107; word-spacing: 0em">Bee</label> Tasks-->
        </a>
        <button class="btn btn-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">

            <i class="fas fa-toolbox"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a title="All PPWs" class="nav-link" href="/petition/list">
                        <i class="fas fa-bars-staggered"></i>
                        All petitions
                    </a>
                </li>
                <li>
                    <a title="Add PPW" class="nav-link " href="/petition/add">
                        <i class="fas fa-plus"></i>
                        Create petition
                    </a>
                </li>
                <li class="nav-item">
                    <a title="History" class="nav-link" href="/history">
                        <i id="themeIcon_history" class="fas fa-clock-rotate-left"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a title="Calendar" class="nav-link" href="/calendar">
                        <i id="themeIcon_calendar" class="fas fa-calendar"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a title="Help" class="nav-link" href="#help1">
                        <i class="fas fa-circle-info"></i>
                    </a>
                </li>
            </ul>
            <div class="collapse navbar-collapse justify-content-end" id="navbarnnn">
                <div sec:authorize="isAuthenticated()">
                    <span class="navbar-text" id="label_of_email" style="margin-right:1em" sec:authentication="name"></span>
                </div>
                <li class="nav-item" style="margin-right:1em" sec:authorize="!isAuthenticated()">
                    <a class="btn btn-warning mr-auto" href="#" th:href="@{/registration/registration-form}">Register</a>
                </li>
                <li class="nav-item" style="margin-right:1em" sec:authorize="!isAuthenticated()">
                    <a class="btn btn-warning mr-auto" href="#" th:href="@{/login}">Login</a>
                </li>
                <li class="nav-item" style="margin-right:1em" sec:authorize="isAuthenticated()">
                    <a class=" btn btn-outline-warning mr-auto" href="#" th:href="@{/logout}">Logout</a>
            </div>
            <div>
                <button class="btn btn-outline-secondary" id="themeToggleBtn" onclick="toggleTheme()">
                    <i id="themeIcon" class="fas fa-sun"></i>
                    <span></span>
                </button>
            </div>
        </div>
    </div>
</nav>

<div class="content-container m-3 rounded shadow">
    <div th:each="petition: ${petitions}" class="container py-5 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col col-lg-6 mb-4 mb-lg-0">
                <div class="card mb-3">
                    <div class="card-body p-4 bg-warning bg-gradient rounded shadow">
                        <h6 class="d-inline" th:text="${petition.header}">Header</h6>
                        <hr class="mt-0 mb-4">
                        <div class="row pt-1">
                            <p th:text="${petition.text}">Description</p>

                        </div>
                        <h6>Information</h6>
                        <hr class="mt-0">
                        <div class="row pt-1">
                            <div class="col-6">
                                <h6>Signed:</h6>
                                <p class="text-muted ">{vote.size}</p>
                            </div>
                            <div class="col-6">
                                <p th:text="${petition.created}">Created:</p>
                            </div>
                            <div class="col-6">
                                <form th:action="@{...\sign}" th:object="${petition}" class="form-group" method="post">
                                    <div style="display: none">
                                        <input type="text" class="form-control" id="delPetition" name="id"></div>
                                    <button type="submit"  class="btn btn-outline-dark">Sign petition</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script>


    // window.addEventListener('DOMContentLoaded', function() {
    //     // Check if the 'username' cookie exists
    //     var username = getCookie('username');
    //
    //     if (!username) {
    //         // Redirect to the login page
    //         // window.location.href = '/login';
    //         redirectToLogin();
    //     }
    //     document.getElementById("label_of_email").innerHTML = getCookie('username');
    // });

    // Function to get the value of a cookie
    function getCookie(name) {
        var cookieArr = document.cookie.split(';');

        for (var i = 0; i < cookieArr.length; i++) {
            var cookiePair = cookieArr[i].split('=');
            var cookieName = cookiePair[0].trim();

            if (cookieName === name) {
                return decodeURIComponent(cookiePair[1]);
            }
        }

        return null;
    }
    function deleteCookie(name) {
        document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    }

    function redirectToLogin() {
        window.location.href = '/login';
    }

    function logout() {
        deleteCookie('username');
        redirectToLogin();
    }

    // theme -----------------------------------------------------
    function toggleTheme() {
        const htmlElement = document.getElementsByTagName('html')[0];
        const currentTheme = htmlElement.getAttribute('data-bs-theme');
        const themeToggleBtn = document.getElementById('themeToggleBtn');
        const themeIcon = document.getElementById('themeIcon');

        if (currentTheme === 'dark') {
            htmlElement.setAttribute('data-bs-theme', 'light');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        } else {
            htmlElement.setAttribute('data-bs-theme', 'dark');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        }

        // Сохранение выбранной темы в файле cookie
        setThemeCookie(htmlElement.getAttribute('data-bs-theme'));
    }
    function setThemeCookie(theme) {
        document.cookie = `theme=${theme}; expires=Fri, 31 Dec 9999 23:59:59 GMT`;
    }
    function loadThemeFromCookie() {
        const cookies = document.cookie.split(';');
        const themeIcon = document.getElementById('themeIcon');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith('theme=')) {
                const theme = cookie.substring(6);
                const htmlElement = document.getElementsByTagName('html')[0];
                htmlElement.setAttribute('data-bs-theme', theme);
                if(theme === "light"){
                    themeIcon.classList.add('fa-sun');
                    themeIcon.classList.remove('fa-moon');
                }
                else{
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
                break;
            }
        }
    }

    // Вызывать эту функцию при загрузке страницы
    loadThemeFromCookie();

</script>
</body>
</html>